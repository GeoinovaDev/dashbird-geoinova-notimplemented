(()=>{"use strict";const t=window,e=[];function s(t,s){if(null==t||"String"!=t.constructor.name||null==s)for(let t=0;t<arguments.length;t++){let s=arguments[t];const n=s.constructor.name;null==i(s)&&("Function"!=n&&"Object"!=n||(s=Object.freeze(s)),e.push(s))}else!function(t,s){s.name=t,e.push(s)}(t,s)}function i(t){return e.find((e=>e.name==t||e.constructor&&e.constructor.name==t))}function n(){return t.location}class type_PiType{static isUndefined(t){return null!==t&&null==t}static typeof(t){let e=null;if(null==t||null==t||type_PiType.isNumber(t)){if(type_PiType.isNumber(t))return"Number";if(void 0===t)return"Undefined";if(null===t)return"Null"}else try{e=t.constructor.name,""==e&&(e="Object")}catch(t){}return e}static isNumber(t){return!("number"!=typeof t||!isFinite(t)||isNaN(t))}static isNullOrUndefined(t){return null==t||null==t}static isFunction(t){return"function"==typeof t}static isArray(t){return"Array"==type_PiType.typeof(t)||!("String"!=type_PiType.typeof(t)||!/^\[.*\]$/gi.test(t))}static isObject(t){return"Object"==type_PiType.typeof(t)||("object"==typeof t||!("String"!=type_PiType.typeof(t)||!/^\{.*\}$/gi.test(t)))}static isString(t){return"string"==typeof t}static isBoolean(t){return"boolean"==typeof t}}s(type_PiType);class PiRandom{static#t=0;static generator(){return PiRandom.range(0,Number.MAX_VALUE)}static range(t,e){t=t||0,e=e||Number.MAX_VALUE;let s=Math.floor(Math.random()*(1+e-t))+t;return s>e?e:s}static uuid(t){let e=(new Date).getTime();return(t||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx").replace(/[xy]/g,(function(t){let s=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?s:3&s|8).toString(16)}))+PiRandom.#t++}}s(PiRandom);class PiString{static capital(t){if(!type_PiType.isString(t))return"";let e=(t=t.toLowerCase()).match(/(^[\s_\.-]*\w|[\s\._-]\w)+/gi);for(let s in e)t=t.replace(e[s],e[s].toUpperCase());return t}static last(t,e=" "){const s=t.split(e);return 0==s.length?t:s[s.length-1]}static first(t,e=" "){const s=t.split(e);return 0==s.length?t:s[0]}static format(t,...e){return t.replace(/{(\d+)}/g,(function(t,s){return void 0!==e[s]?e[s]:t}))}static clips(t,e,s){let i=[],n=-1;for(;n=t.indexOf(e,n+1),-1!=n;){n+=e.length;let r=t.indexOf(s,n+1);if(-1==r)break;i.push(t.substr(n,r-n)),n=r+1}return i}static isAlphaNumeric(t){let e,s;if(8==(t.which?t.which:t.keyCode))return!0;if(window.event)e=t.keyCode;else{if(!t.which)return!0;e=t.which}return s=String.fromCharCode(e),/[a-zA-Z0-9]/.test(s)}static space2nbsp(t){return null==t?"":t.replace(/\s/gi,"&nbsp;").replace(/\-/gi,"&nbsp;-&nbsp;")}static reticencias(t,e){return t.length>e?t.substring(0,e)+"...":t}static removeSpace(t){return(t||"").replace(/\s*/gi,"")}static firstWord(t){return type_PiType.isString(t)?t.split(" ")[0]:""}static lastWord(t){if(type_PiType.isString(t)){let e=t.split(" ");return e[e.length-1]}return""}static firstAndlastWord(t){let e=t.split(" "),s="";return 1==e.length?t:(s=t.split(" ")[0],s+" "+e[e.length-1])}static capital(t){if(!type_PiType.isString(t))return"";let e=(t=t.toLowerCase()).match(/(^[\s_\.-]*\w|[\s\._-]\w)+/gi);for(let s in e)t=t.replace(e[s],e[s].toUpperCase());return t}static replace(t,e,s){return t.replace(new RegExp(e,"g"),s)}static cut(t,e){if(!type_PiType.isString(t)||e<0)return t;let s=t.split(" "),i=[];i.push(s[0]),e>s.length&&(e=s.length);for(let t=1;t<e;t++)i.push(s[t]);return s.length>e&&i.push(s[s.length-1]),i.join(" ")}}s(PiString);class PiObject{static extendAndCall=function(){let t=arguments[0];for(let e=arguments.length-1;e>0;e--){let s=arguments[e];for(let e in s)"function"==typeof t[e]?t[e](s[e]):t[e]=s[e]}return t};static extractPropertyContext=function(t,e){let s=e.split(".");if(s.length>1)for(let e=0;e<s.length-1;e++){let i=s[e];null==t[i]&&(t[i]={}),t=t[i]}return t};static on=function(t,e,s,i=!0){let n=PiObject.extractValue(t,e),r=e.split(".");null==t.__onSetList&&(t.__onSetList=[],t.__onSetFn=[]),null==t.__onSetFn[e]&&(t.__onSetFn[e]=[]);if(!(void 0!==t.__onSetList.find((t=>t==e)))){const s=PiObject.extractPropertyContext(t,e),i=PiString.last(e,".");"length"==i&&PiType.isArray(s)||(Object.defineProperty(s,i,{set:function(s){n=s;const i=t.__onSetFn[e];for(let t=0;t<i.length;t++)i[t].cb(s,e);return s},get:function(){return n}}),t.__onSetList.push(e))}const l=PiRandom.uuid("xxx-xxx");let a=[l];if(t.__onSetFn[e].push({id:l,cb:s}),i&&r.length>1){r.pop();const e=PiObject.on(t,r.join("."),s);a=a.concat(e)}return a};static off=function(t,e){if(null!=t.__onSetFn)for(const s in t.__onSetFn){const i=t.__onSetFn[s];for(let t=0;t<i.length;t++){const s=i[t];e.find((t=>t==s.id))&&(t--,i.splice(t,1))}}};static extractValue=function(t,e){const s=e.split(".");if(s.length>1){for(let e=0;e<s.length&&null!=(t=t[s[e]]);e++);return t}return t[e]};static setProperty=function(t,e,s){const i=e.split(".");if(i.length>1){const e=i[i.length-1];for(let e=0;e<i.length-1&&null!=(t=t[i[e]]);e++);t[e]=s}else t[e]=s};static extend=function(){for(let t=1;t<arguments.length;t++){let e=arguments[t];for(let t in e)arguments[0][t]=e[t]}return arguments[0]}}class PiClass{#e=null;constructor(...t){this.instances(...t),type_PiType.isObject(t[0])&&PiObject.extendAndCall(this,t[0]),this.#e=null==t[0]?{}:t[0],this.init(...t)}instances(){}get parameters(){return this.#e}inject(t){for(var e in t)this[e]=t[e];return this}init(){}jsonWillConvert(){}toJson(){this.jsonWillConvert();let t=JSON.parse(JSON.stringify(this));return this.jsonDidConvert(t),t}jsonDidConvert(t){}cloneWillLoad(){}clone(){this.cloneWillLoad();let t=this.toJson(),e=new this.constructor(t);return this.cloneDidLoad(e),e}cloneDidLoad(){}static create(...t){return new this(...t)}create(...t){return new this.constructor(...t)}}class PiEvent{#s=[];listen(t,e,s,i=!1){const n=PiRandom.uuid("xxx-xx");return e.id=n,this.#s.push({uuid:n,event:t,cb:e,ctx:s,once:i}),n}unlisten(t,e="*"){for(let s=this.#s.length-1;s>=0;s--){let i=this.#s[s];if(i.event==t){if(e===i.uuid){this.#s.splice(s,1);break}"*"!=e&&e.id!=i.cb.id||(this.#s.splice(s,1),s--)}}return this}once(t,e,s){return this.listen(t,e,s,!0)}trigger(t,...e){let s=[];for(let i=0;i<this.#s.length;i++)if(this.#s[i].event==t){let t=this.#s[i];t.cb.apply(t.ctx,e),t.once&&s.push(t)}for(let t=s.length-1;t>=0;t--)this.unlisten(s[t].event,s[t].cb);return this}exist(t){for(let e=this.#s.length-1;e>=0;e--)if(this.#s[e].event==t)return!0;return!1}reseed(t,e){return t instanceof PiEvent?(this._reseedAll(e),this):(this.listen(t,(function(){e.trigger.call(e,t,...arguments)})),this)}_reseedAll(t){for(let e=this.#s.length-1;e>=0;e--){const s=this.#s[e].event;this.reseed(s,t)}}clear(){return this.#s=[],this}}const r={app:{parse:{enable:!0,selector:"body"}},html:{loader:"Carregando ..."},expression:{xlanguage:/(\{>?)([^\}]+)(\})/gi,xvariable:/(@)([\w\.]+)/gi,xhtml:/(\{>)([^\}]+)(\})/gi},history:{popstate:!1,prefixHashtag:!0},services:[],request:{fetch:null}};class PiConfig{static set(t,e){return PiObject.setProperty(r,t,e),PiConfig}static get(t){return PiObject.extractValue(r,t)}static load(t){return PiObject.extend(r,t),PiConfig}static extend(t,e=!1){return 0==e?PiObject.extend(r,t):PiObject.extend(r,{settings:e})}}const l=PiConfig;s(PiConfig);class PiDictionary{#s=[];add(t,e){return this.#s[t]=e,this}existKey(t){return null!=this.#s[t]}existValue(t){for(let e=this.#s.length-1;e>=0;e--)if(this.#s[e]==t)return!0;return!1}getValue(t){return this.#s[t]}remove(t){return delete this.#s[t],this}clear(){return this.#s=[],this}toArray(){return this.#s}}class PiAs{#i=new PiDictionary;add(){if(arguments.length<2)throw"PiAs: numero insulficiente de parametros";if(this.#i.existKey(arguments[0]))throw"PiAs: este apelido ja foi definido: "+arguments[0];let t="";for(let e=1;e<arguments.length;e++){let s=arguments[e];this.#i.existKey(s)?t+=this.#i.getValue(s):t+=s}return this.#i.add(arguments[0],t),!0}update(){if(arguments.length<2)throw"PiAs: numero insulficiente de parametros";if(this.#i.existKey(arguments[0]))return this.remove(arguments[0]),!1;let t="";for(let e=1;e<arguments.length;e++){let s=arguments[e];this.#i.existKey(s)?t+=this.#i.getValue(s):t+=s}return this.#i.add(arguments[0],t),!0}remove(t){return this.#i.remove(t),this}exist(t){return this.#i.existKey(t)}getValue(t){let e=this.#i.getValue(t);return 0==this.exist(t)?null:this.#i.existKey(e)?this.getValue(e):e}}class PiUrl extends PiClass{static alias=new PiAs;init(){let t=arguments,e="";for(let s=0;s<t.length;s++){let i=t[s];PiUrl.alias.exist(t[s])&&(i=PiUrl.alias.getValue(t[s])),"/"==i[0]&&"/"==e[e.length-1]?e+=i.substring(1):e+=i}this.setUrl(e)}setUrl(t){return PiUrl.alias.exist(t)&&(t=PiUrl.alias.getValue(t)),PiUrl.isValid(t)&&(this._url=t),this}scheme(){let t=this.getUrl(),e=t.indexOf(":");return e<0?"":t.substr(0,e)}host(t){let e=this.getUrl(),s=this._parse(e,"host");return void 0===t?s:(this.setUrl(e.replace(s,t)),this)}port(t){let e=this.getUrl(),s=this._parse(e,"port")||"";if(type_PiType.isUndefined(t))return s;let i=this.port()||"",n=this.href();return e=0==i.length?e.replace(n,n+":"+t):e.replace(s,t),this.setUrl(e),this}href(t){let e=this.host(),s=e,i=this._parse(this.getUrl(),"scheme");if(void 0===t){let t=this.port();return t=0==t.length?"":":"+t,s=i.length>0?i+"://"+e+t:e+t,s}return this.setUrl(t),this}hash(t){let e=this.getUrl(),s=this._parse(e,"hash");return void 0===t?s:(0==s.length?this.setUrl(e+"#"+t):this.setUrl(e.replace(s,t)),this)}appendPath(t){let e=this.getUrl();this._parse(e,"path");return PiUrl.alias.exist(t)&&(t=PiUrl.alias.getValue(t)),"/"!=e.substring(e.length-1)&&(e+="/"),this.setUrl(e+t),this}path(t){let e=this.getUrl(),s=this._parse(e,"path"),i="/"+s;return void 0===t?i:(PiUrl.alias.exist(t)&&(t=PiUrl.alias.getValue(t)),0==s.length?"/"!=e.substring(e.length-1)&&"/"!=t.charAt(0)?e+="/"+t:e+=t:e=e.replace(i,t),this.setUrl(e),this)}filename(t){let e=this.getUrl();if(void 0===t)return e.replace(/\\/g,"/").replace(/.*\//,"").replace(/\?.*/,"")||"";{let e=this.getUrl(),s=this.filename();return this.setUrl(e.replace(s,t)),this}}query(t){let e=this.getUrl(),s=this._parse(e,"query");if(void 0===t)return s;{let s=this.query();return this.setUrl(e.replace(s,t)),this}}addQuery(t,e){let s=this.query(),i=this.getUrl(),n=PiString.format("{1}={2}",i,t,encodeURIComponent(e));return 0==s.length?this.setUrl(i+"?"+n):this.setUrl(i+"&"+n),this}getQuery(t){let e=this.query().split("&");for(var s=0;s<e.length;s++){let i=e[s].split("=");if(i[0]==t)return decodeURIComponent(i[1])}return""}dirname(){return this.getUrl().replace(/\\/g,"/").replace(/\/[^\/]*$/,"")}getUrl(){return this._url||""}toString(){return this.getUrl()}_parse(t,e){let s=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(t||"");return null==s?"":s[{url:0,scheme:1,slash:2,host:3,port:4,path:5,query:6,hash:7}[e]]||""}static isValid(t){return/(http|https|)(:\/\/|)([\w-]+\.?)+[\w-]+(\/[\w- .\/?%&=]*)?/.test(t||"")}static add(){PiUrl.alias.add.apply(PiUrl.alias,arguments)}static get(t){return PiUrl.alias.getValue(t)}static to(){let e=arguments,s="";for(let t=0;t<arguments.length;t++){let i=e[t];PiUrl.alias.exist(e[t])&&(i=PiUrl.alias.getValue(e[t])),"/"==i[0]&&"/"==s[s.length-1]?s+=i.substring(1):s+=i}!function(e){t.location=e}(s)}static query(t){let e=PiUrl.create(n()).query().split("&");for(let s in e){let i=e[s].split("=");if(i[0]==t)return i[1]}}}s(PiUrl);class ChainRequestItem{next=null;#n=null;constructor(t){this.#n=t}invoke(){this.#n.call(this.#n,...arguments,(()=>{this.next.invoke(...arguments)}))}}class ChainRequest{#r=[];first(){return 0==this.#r.length?null:this.#r[0]}last(){return 0==this.#r.length?null:this.#r[this.#r.length-1]}add(t){if(null==t)return this;const e=this.last(),s=new ChainRequestItem(t);return null!=e&&(e.next=s),this.#r.push(s),this}invoke(){const t=this.first();return null==t||t.invoke.apply(t,arguments),this}}class PiRequest extends PiClass{#l=!1;#a=null;#o=new ChainRequest;#h="POST";constructor(){super(),this.#o.add(l.get("request.fetch")).add(((t,e,s,i)=>{try{fetch(t,e).then((t=>{this.#l=!1,t.status>=200&&t.status<300?t.text().then((e=>{s(e,t.status)})):t.text().then((e=>{i(e,t.status)})),this.#a=null})).catch((function(t){"Failed to fetch"==t.message&&i(`{ "message": "${t.message}", "status": "error" }`,503)}))}catch(i){i('{ "message": "offline", "status": "error" }',503)}}))}addHandler(t){return this.#o.add(t),this}abort(){return this.#a&&(this.#a.abort(),this.#a=null,this.#l=!1),this}isSending(){return this.#l}setMethod(t){return this.#h=t,this}get(t,e,s=(t=>t)){return new Promise(((i,n)=>{let r="";null!=e&&(r="?"+this.#c(e)),this.#u(t+r,((t,e)=>{i(t,e)}),((t,e)=>{n(t,e)}),s)}))}getJson(t,e,s=(t=>t)){return new Promise(((i,n)=>{let r="";null!=e&&(r="?"+this.#c(e)),this.#u(t+r,((t,e)=>{if(0==t.length)return void i({});let s=JSON.parse(t);this.#d(s)?"ok"==s.status?i(s):n(s.message,e):i(s)}),((t,e)=>{if(0==t.length)return void n({},e);let s=JSON.parse(t);this.#d(s)?"error"==s.status&&n(s.message,e):n(s,e)}),s)}))}post(t,e,s=null){return new Promise(((i,n)=>{let r=this.#c(e);this.#p(t,encodeURI(r),((t,e)=>{i(t,e)}),((t,e)=>{n(t,e)}),(t=>(t.headers.append("Content-Type","application/x-www-form-urlencoded"),s&&s(t),t)))}))}sendFiles(t,e,s=null){return new Promise(((i,n)=>{for(var r=new FormData,l=0;l<e.length;l++)r.append(`file${l}`,e[l]);this.#p(t,r,((t,e)=>{if(0==t.length)return void i({});let s=JSON.parse(t);this.#d(s)?"ok"==s.status?i(s):n(s.message,e):i(s)}),((t,e)=>{if(0==t.length)return void n({},e);let s=JSON.parse(t);this.#d(s)?"error"==s.status&&n(s.message,e):n(s,e)}),(t=>(s&&s(t),t)))}))}postJson(t,e,s=null){return new Promise(((i,n)=>{this.#p(t,JSON.stringify(e),((t,e)=>{if(0==t.length)return void i({});let s=JSON.parse(t);this.#d(s)?"ok"==s.status?i(s):n(s.message,e):i(s)}),((t,e)=>{if(0==t.length)return void n({},e);let s=JSON.parse(t);this.#d(s)?"error"==s.status&&n(s.message,e):n(s,e)}),(t=>(t.headers.append("Content-Type","application/json"),s&&s(t),t)))}))}#u(t,e,s,i){this.#h="GET",this.#_(t,((t,s)=>{e(t,s)}),((t,e)=>{s(t,e)}),(t=>(t.method=this.#h,t.headers.append("X-Requested-With","XMLHttpRequest"),i(t))))}#p(t,e,s,i,n){this.#_(t,((t,e)=>{s(t,e)}),((t,e)=>{i(t,e)}),(t=>(t.method=this.#h,t.headers.append("X-Requested-With","XMLHttpRequest"),t.body=e,n(t))))}#_(t,e,s,i){var n=new Headers;n.append("Accept","application/json, text/plain, */*"),this.#a=new AbortController;var r=i({signal:this.#a.signal,mode:"cors",headers:n}),l=t instanceof PiUrl?t:PiUrl.create(t);this.#l=!0,this.#o.invoke(l,r,e,s)}#d(t){return t.status}#c(t){let e="";for(let s in t)t.hasOwnProperty(s)&&(e.length>0&&(e+="&"),e+=s+"="+t[s]);return e}}class PiPromise extends PiClass{#m=!1;#f=this.newPromise();instances(){this.clear()}static wait(t=null){var e=new PiPromise,s=0,i=!0,n=t||arguments;for(let t=0;t<n.length;t++)n[t].finally((()=>{++s==n.length&&(i?e.resolve():e.reject())})).catch((()=>{i=!1}));return e}get(){return this.#f}newPromise(){return new Promise(((t,e)=>{this.ok(t),this.error(e)}))}resolve(){return this._argOk=arguments,this._callOk(),this._callOnce(),this._callDone(),this.#m&&this.reset(),this}link(t){const e=this;return t.ok((function(){e.resolve.apply(e,arguments)})),t.error((function(){e.reject.apply(e,arguments)})),this}reject(){return this._argErr=arguments,this._callErr(),this._callDone(),this.#m&&this.reset(),this}ok(t,e){return this._cbOk.push({cb:t,context:e}),this._isOk&&this._callOk(),this}then(){return this.ok.apply(this,arguments)}once(t,e){return this._cbOnce.push({cb:t,context:e}),this._isOk&&this._callOnce(),this}error(t,e){return this._cbErr.push({cb:t,context:e}),this._isErr&&this._callErr(),this}catch(){return this.error.apply(this,arguments)}done(t,e){return this._cbDone.push({cb:t,context:e}),this._isDone&&this._callDone(),this}finally(){return this.done.apply(this,arguments)}reset(){return this._cbOk=[],this._cbErr=[],this._cbDone=[],this}clear(){return this._cbOk=[],this._cbErr=[],this._cbDone=[],this._cbOnce=[],this._isOk=!1,this._isErr=!1,this._isDone=!1,this._argOk=[],this._argErr=[],this}toPromise(){return this.#f}_call(t,e){for(let s=t.length-1;s>=0;s--)t[s].cb.apply(t[s].context,e)}_callOnce(){this._isOk=!0,this._call(this._cbOnce,this._argOk),this._cbOnce=[]}_callOk(){this._isOk=!0,this._call(this._cbOk,this._argOk)}_callErr(){this._isErr=!0,this._call(this._cbErr,this._argErr)}_callDone(){this._isDone=!0,this._call(this._cbDone,[])}}s(PiPromise);class PiAction extends PiClass{#g=new PiRequest;#f=new PiPromise;constructor(t){super(t),this._load()}get promise(){return this.#f}invoke(){return this._callModelMethod.apply(this,arguments)}processErrorResponse(){this.#f.reject.apply(this.#f,arguments)}processSuccessResponse(t,e){if(this._ignore_response)this.#f.resolve(this.model);else if(type_PiType.isArray(t)){const s=[],i=[];for(let e=0;e<t.length;e++){const n=this.model.create().initWithJson(t[e]);n instanceof PiPromise?(n.ok((t=>{s.push(t)})),i.push(n)):s.push(n)}0==i.length?this.#f.resolve(s,e):PiPromise.wait(i).ok((()=>{this.#f.resolve(s,e)}))}else{const s=this.model.create().initWithJson(t);s instanceof PiPromise?s.ok((t=>{this.#f.resolve(t,e)})):this.#f.resolve(s,e)}}_load(){this._parseStmt(this.actionStmt),this._addModelMethod()}_addModelMethod(){var t=this;this._is_static?this.model.constructor[this.actionName]=function(){const e=new PiAction({actionName:t.name,actionStmt:t.stmt,model:t.model.clone()}),s=e.invoke.apply(e,arguments);return new Promise(((t,e)=>{s.ok(t),s.error(e)}))}:this.model[this.actionName]=function(){const e=t.invoke.apply(t,arguments);return new Promise(((t,s)=>{e.ok(t),e.error(s)}))}}_callModelMethod(...t){return this.#f=new PiPromise,type_PiType.isObject(t[0])&&this.model.inject(t[0]),"GET"!=this._method&&"OPTIONS"!=this._method||this._createRequestGet.apply(this,t),"PUT"!=this._method&&"POST"!=this._method&&"DELETE"!=this._method&&"PATH"!=this._method||this._createRequestPost.apply(this,t),this.#f}_createRequestGet(...t){let e=this._createUrl(...t);this.#g.isSending()&&this.#g.abort(),this.model.requestWillGet(e),this.#g.getJson(e).then((t=>{this.model.responseSuccessWillLoad.apply(this.model,[this,e,t.data,t.paging])})).catch((s=>{if(t[0]instanceof TypeError)throw t[0];this.model.responseErrorWillLoad.apply(this.model,[this,e,s.data,s.paging])})),this.model.requestDidGet(e)}_createRequestPost(...t){let e=this._createUrl(...t),s=this.model.toJson();this.#g.isSending()&&this.#g.abort(),this.model.requestWillPost(s,e),this.#g.setMethod(this._method).postJson(e,s).then((t=>{this.model.responseSuccessWillLoad.apply(this.model,[this,e,t.data,t.paging])})).catch(((...t)=>{if(t[0]instanceof TypeError)throw t[0];this.model.responseErrorWillLoad.apply(this.model,[this,e,s.data,s.paging])})),this.model.requestDidPost(s,e)}_createUrl(...t){let e=this._getAction(...t),s="";return s=this.model.getBaseUrl()instanceof PiUrl?PiUrl.create(this.model.getBaseUrl()).path(e):this.model.getBaseUrl().indexOf("http")>-1?PiUrl.create(this.model.getBaseUrl()+e):PiUrl.create("localhost",this.model.getBaseUrl()+e),s}_getAction(...t){let e=0;return this._url.replace(/\:\w+[\(\w*\)]*/gi,(s=>{let i=s.substring(1),n=this.model[i]||"";return 0==t.length?n:(t[e++]||n).toString()}))}_parseStmt(t){const e=t.split(":/"),s=e[0],i=e[1];this._is_static=!1,s.indexOf("static")>-1&&(this._is_static=!0),this._ignore_response=!1,s.indexOf("~")>-1&&(this._ignore_response=!0),this._url=i.length?"/"+i:"",t.toUpperCase().indexOf("GET")>-1?this._method="GET":t.toUpperCase().indexOf("POST")>-1?this._method="POST":t.toUpperCase().indexOf("PUT")>-1?this._method="PUT":t.toUpperCase().indexOf("DELETE")>-1?this._method="DELETE":t.toUpperCase().indexOf("PATH")>-1?this._method="PATH":t.toUpperCase().indexOf("OPTIONS")>-1?this._method="OPTIONS":this._url.indexOf("?")>-1?this._method="GET":this._method="POST"}}class PiUrlHash{static _callbacks=[];static _fnWillChanges=[];static _fnDidChanges=[];#x=0;hashDidChange(){}listen(){return this.#x=PiRandom.uuid("xxx-xxx"),PiUrlHash._callbacks.push({id:this.#x,cb:()=>this.hashDidChange(PiUrlHash.get())}),this}unlisten(){const t=PiUrlHash._callbacks;for(let e=0;e<t.length;e++){if(t[e].id==this.#x)return PiUrlHash._callbacks.splice(e,1),this}return this}static get(){let t=n().hash;return t=0==t.length?t:t.substr(1),t}static to(t){let e=PiUrlHash.get(),s=e.indexOf("?");return s>-1?(s=e.substr(s),e=e.substr(0,s)):s="","!"+e==t||"!"+t==e?this:(s.length>0&&(t+=s),n().hash=t,PiUrlHash)}static getQueryString(t){let e=PiUrlHash.get().split("?");if(e.length<2)return"";let s=e[1].split("&");for(let e=0;e<s.length;e++){var i=s[e].split("=");if(i[0]==t)return decodeURIComponent(i[1])}return""}static getQueryInt(t){return parseInt(PiUrlHash.getQueryString(t))}static getQueryFloat(t){return parseFloat(PiUrlHash.getQueryString(t))}static removeQueryString(t){let e=PiUrlHash.get().split("?");if(null==t)return n().hash=e[0],PiUrlHash;let s=[],i=[];if(e.length>1){s=e[1].split("&");for(let t=0;t<s.length;t++){if(0==s[t].length)continue;let e=s[t].split("=");i[e[0]]=e[1]}}delete i[t];var r=[];for(const t in i)r.push(`${t}=${i[t]}`);return n().hash=`${e[0]}?${r.join("&")}`,PiUrlHash}static addQueryString(t,e=""){let s=PiUrlHash.get().split("?"),i=[],r=[];if(s.length>1){i=s[1].split("&");for(let t=0;t<i.length;t++){if(0==i[t].length)continue;let e=i[t].split("=");r[e[0]]=e[1]}}r[t]=e||"";var l=[];for(const t in r)l.push(`${t}=${r[t]}`);return n().hash=`${s[0]}?${l.join("&")}`,PiUrlHash}static add(...t){let e=PiUrlHash.get();e.length>0?PiUrlHash.to(e+"/"+t.join("/")):PiUrlHash.to(t.join("/"))}static remove(t){return n().hash=n().hash.replace(t,""),this}static onWillChange(t){PiUrlHash._fnWillChanges.push(t)}static onDidChange(t){PiUrlHash._fnDidChange.push(t)}}var a=null;t.onhashchange=function(){if(a==PiUrlHash.get())return;a=PiUrlHash.get();const t=PiUrlHash._callbacks;for(let t=0;t<PiUrlHash._fnWillChanges.length;t++)PiUrlHash._fnWillChanges[t](a);for(var e=0;e<t.length;e++)t[e].cb();for(let t=0;t<PiUrlHash._fnDidChanges.length;t++)PiUrlHash._fnDidChanges[t](a)},s(PiUrlHash),0==n().host.length?PiUrl.add("localhost","http://localhost"):PiUrl.add("localhost",PiUrl.create(n().toString()).href());class PiApp extends PiClass{page=null;services=[];_totalRouteNotFound=0;init(){super.init(),PiUrlHash.onWillChange((()=>{this._totalRouteNotFound=0}))}register(){for(let t=0;t<arguments.length;t++){s(arguments[t])}return this}addServices(){for(let t=0;t<arguments.length;t++){const e=arguments[t];e.onRouteNotFound((t=>{this._totalRouteNotFound++,this._totalRouteNotFound==this.services.length&&this.#b(t)})),this.services.push(e)}return this}startServices(){for(let t=0;t<this.services.length;t++){this.services[t].start()}return this}stopServices(){for(let t=0;t<this.services.length;t++){this.services[t].stop()}return this}setPage(t){return this.page&&this.page.destroy(),t.render(this.element),this.page=t,this}getPage(){return this.page}openModal(t){t.render(this.element,!0)}#b(t){for(let e=0;e<this.services.length;e++){const s=this.services[e];s.routeNotFound&&s.routeNotFound(t)}return this}}class PiModel{#e=null;#P=[];#v=[];#y="";constructor(...t){this.#P=[],this.#v=[],this.#y="",type_PiType.isObject(t[0])&&PiObject.extendAndCall(this,t[0]),this.#e=null==t[0]?{}:t[0],this.init(...t)}getBaseUrl(){return this.#y}_inject(t){for(var e in t)this[e]=t[e];return this}clone(){this.cloneWillLoad();let t=this.toJson(),e=new this.constructor(t);return this.cloneDidLoad(e),e}cloneDidLoad(){}cloneWillLoad(){}static create(...t){return new this(...t)}create(...t){return new this.constructor(...t)}toJson(){this.jsonWillConvert();let t=JSON.parse(JSON.stringify(this));return this.jsonDidConvert(t),t}jsonDidConvert(t){}jsonWillConvert(){}instances(){}init(t){this._loadActions(),this._loadValidations(),this._configUrl(t||this.#e.url||"")}initWithJson(t){return this._inject(t),this}addAction(t,e){const s=new PiAction({actionName:t,actionStmt:e,model:this});return this.#P[t]=s,this}addValidator(t,e){return this.#v[t]=e,this}validators(){return{}}actions(){return{}}setProperty(t,e,s){const i=t.split(".");let n=i.length>1,r=this.#v[t];if("int"===s)e=parseInt(e),isNaN(e)&&(e=0);if(n){let s=i[i.length-1],n=PiObject.extractPropertyContext(this,t);n instanceof PiModel?n.setProperty(s,e):n[s]instanceof Function?n[s](e):n[s]=e}else if(null==r)this[t]instanceof Function?this[t](e):this[t]=e;else{if(r.load(this,t,e),!r.isValid())throw r.label;this[t]=e}return this}save(){return null==this.id||0==this.id?this.insert():this.update()}getAction(t){return this.#P[t]}inject(t,e={}){if(t instanceof PiComponent||t instanceof PiApp){let n=PiString.clips(t.element.innerHTML,'data-model="','"'),r=!1,l=[];e=PiObject.extend({},{invalidInputClass:"invalid-feedback"},e);for(let a=0;a<n.length;a++){let o,h=n[a],c=t.element.querySelector('[data-model="'+h+'"]'),u=c.parentNode;c.firstChild&&c.firstChild._hasComponent?(o=c.firstChild._component.get(),r=!0):c._hasComponent?(o=c._component.get(),r=!0):(r=!1,o=c.get());var s=c.nextElementSibling,i=null;s&&s.hasAttribute("validation-message")?i=s:((i=document.createElement("div")).setAttribute("validation-message",""),u.insertBefore(i,c.nextSibling)),c.setCustomValidity&&c.setCustomValidity(""),i.style.display="none",i.innerHTML="",i.classList.remove(e.invalidInputClass),u.classList.remove("was-validated");try{this.setProperty(h,o,c.getAttribute("data-type"))}catch(t){i.innerHTML=t,i.classList.add(e.invalidInputClass),i.style.display="block",c.setCustomValidity&&c.setCustomValidity(t),r||u.classList.add("was-validated"),l.push(t)}}return l}return t instanceof PiModel?this._inject(t.toJson()):this._inject(t),[]}requestWillGet(t){}jsonDidConvert(t){}requestDidGet(t){}requestWillPost(t){}requestDidPost(t){}responseSuccessWillLoad(t,e,s){this.responseSuccess.apply(this,arguments)}responseSuccess(t,e,...s){t.processSuccessResponse.apply(t,s),this.responseSuccessDidLoad.apply(this,arguments)}responseSuccessDidLoad(){}responseErrorWillLoad(t,e,s){this.responseError.apply(this,arguments)}responseError(t,e,...s){t.processErrorResponse.apply(t,s),this.responseErrorDidLoad.apply(this,arguments)}responseErrorDidLoad(){}_loadActions(){const t=this.actions(),e=PiObject.extend({},{add:"POST:/",insert:"POST:/",update:"PUT:/:id",remove:"REMOVE:/:id",get:"GET:/:id",find:"GET:/find/:id",all:"GET:/"},t);for(let t in e)this.addAction(t,e[t])}_configUrl(t){const e=l.get("model.url");null==e?this.setBaseUrl(t):this.setBaseUrl(e+t)}setBaseUrl(t){return this.#y=null==t?PiUrl.create("localhost").href():t,this}_loadValidations(){const t=this.validators();for(var e in t)this.addValidator(e,t[e])}static register(t){s(t)}}class PiTree{constructor(){}static parse(t){const e=new PiTree;t instanceof Element&&(t=t.innerHTML);const s=e._loadDocument(t);return e._loadElementRoot(s)}_loadDocument(e){try{return(new t.DOMParser).parseFromString(e,"text/html")}catch(t){console.log("PiTree: O html informado esta formatado incorretamente"),console.log(e)}return null}_loadElementRoot(t){if(null==t)return null;const e=document.createDocumentFragment(),s=[...t.getElementsByTagName("body")[0].children];for(let t=0;t<s.length;t++)e.appendChild(s[t]);return e}}class PiStatement{static exec(t,e){return PiStatement.execWithVariables(t,[[],[]],e)}static execWithVariables(t,e,s){const i=e[0],n=e[1];for(let e=0;e<i.length;e++){const s=i[e];"this"!=s?(i[e]=i[e].replaceAll(".",""),t=t.replaceAll(s,i[e])):(i.splice(e,1),e--)}return new Function("_this",...i,`return (function(){return ${t}}).call(_this);`)(s,...n)}}const o=new class PiTranslate{#C={};load(t){return PiObject.extend(this.#C,t),this}set(t,e){return this.#C[t]=e,this}get(t){return this.#C[t]||""}exist(t){return null!=this.#C[t]}clear(){return this.#C={},this}};const h={_all:[],register(t,e){this._all.push([t,e])},get all(){return this._all}};h.register("_",(function(){return o.get.apply(o,arguments)}));const c=h;class PiExpression{constructor(t){this._template=t,this._rxExpression=l.get("expression.xlanguage"),this._rxVariable=l.get("expression.xvariable"),this._load()}setDelimiters(t){return this._rxExpression=t,this}get all(){const t=[];for(let e=0;e<this._expressions.length;e++)t.push(this._clear(this._expressions[e].value));return t}get variables(){return null==this._variables&&(this._variables=this._extractAllVariables()),this._variables}parse(t,e=[[],[]]){let s=this._expressions,i=this._phrase;const n=Object.keys(t),r=Object.values(t);for(let e=0;e<r.length;e++){const s=r[e];s instanceof Function&&(r[e]=s.bind(t))}e[0]=n.concat(e[0]),e[1]=r.concat(e[1]);for(let t=0;t<c.all.length;t++){const s=c.all[t];e[0].push(s[0]),e[1].push(s[1])}for(let n=0;n<s.length;n++){const r=s[n],l=this._clear(r.value);let a=PiStatement.execWithVariables(l,e,t);type_PiType.isNumber(a)&&0==a?a="0":type_PiType.isObject(a)&&(a=JSON.stringify(a)),i=i.replace(r.key,type_PiType.isBoolean(a)?a:a||"")}return i}_load(){var{phrase:t,expressions:e}=this._extractPhraseAndExpressions();this._phrase=t,this._expressions=e}_clear(t){return(t=(t=t.replace(this._rxExpression,(function(t,e,s,i){return s}))).replace(this._rxVariable,(function(t,e,s,i){return s}))).trim()}_extractPhraseAndExpressions(){var t=[],e=1;return{phrase:this._template.replace(this._rxExpression,(function(s){const i=`_$${e++}_`;return t.push({value:s,key:i}),i})),expressions:t}}_extractAllVariables(){var t=this._template.match(this._rxVariable)||[];for(let e=0;e<t.length;e++){const s=t[e];t[e]=s.substr(1)}return t}_extractVariables(t){var e=t.match(this._rxVariable)||[];for(let t=0;t<e.length;t++){const s=e[t];e[t]=s.substr(1)}return e}_extractVariablesValues(t,e){const s=[];for(let i=0;i<t.length;i++){const n=t[i];s.push(PiObject.extractValue(e,n))}return s}}const u=/^(\w+)\s+in\s+range\(\s*(-?\d+)\s*\)$/gi,d=/^(\w+)\s+in\s+range\(\s*(-?\d+)\s*,\s*(-?\d+)\s*\)$/gi,p=/^(\w+)\s+in\s+range\(\s*(-?\d+)\s*,\s*(-?\d+)\s*,\s*(-?\d+)\s*\)$/gi,_=/^(\w+)\s+in\s+([0-9]+)$/gi,m=/^(\w+)\s+in\s+(\w+)$/gi;class PiForDirective{constructor(t){this._stmt=t,this._iterableCount=null,this._iterableProperty=null,this._iterableStart=0,this._iterableStep=1,this._indexName=null,this._loop=null,this._end=null,this._load()}get objectInterableName(){return this._iterableProperty}loop(t){return this._loop=t,this}end(t){return this._end=t,this}run(t=null){let e=0;if(null!=t?e=t:this._iterableCount&&(e=this._iterableCount),this._iterableStep<0)for(let t=this._iterableCount-this._iterableStart;t>=0;t+=this._iterableStep)this._loop(this._indexName,t);else for(let t=this._iterableStart;t<e;t+=this._iterableStep)this._loop(this._indexName,t);return this._end(),this}_loadNumber(t){const e=parseInt(t);type_PiType.isNumber(e)?(this._iterableCount=e,this._iterableProperty=null):(this._iterableCount=null,this._iterableProperty=t)}_load(){if(u.test(this._stmt))this._loadForRange1();else if(d.test(this._stmt))this._loadForRange2();else if(p.test(this._stmt))this._loadForRange3();else if(_.test(this._stmt))this._loadForLiteral();else{if(!m.test(this._stmt))throw`PiForDirective: Statement inválida para laço for = ${this._stmt}. Padrão esperado: (variável in literal) ou (variável in range(total[, inicio[, passo]]))`;this._loadForProperty()}}_loadForRange1(){this._stmt.replace(u,((t,e,s)=>(this._loadNumber(s),this._indexName=e,t)))}_loadForRange2(){this._stmt.replace(d,((t,e,s,i)=>(this._loadNumber(s),this._indexName=e,this._iterableStart=parseInt(i),t)))}_loadForRange3(){this._stmt.replace(p,((t,e,s,i,n)=>(this._loadNumber(s),this._indexName=e,this._iterableStart=parseInt(i),this._iterableStep=parseInt(n),t)))}_loadForProperty(){this._stmt.replace(m,((t,e,s)=>(this._loadNumber(s),this._indexName=e,t)))}_loadForLiteral(){this._stmt.replace(_,((t,e,s)=>(this._iterableCount=parseInt(s),this._indexName=e,t)))}}class PiFunction{static noop(){}}const f=/^\((\w+)\s*,\s*(\w+)\)\s+in\s+(\w+(\.\w+)*)$/gi;class PiForEachDirective{constructor(t,e={},s=PiFunction.noop){this._stmt=t,this._context=e,this._fn=s,this._end=PiFunction.noop,this._load()}get variableInterableName(){return this._variableInterableName}get objectInterableName(){return this._objectInterableName}loop(t){return this._fn=t,this}run(t=null,e=0,s=-1,i=1){const n=t||PiObject.extractValue(this._context,this._objectInterableName);if("Function"==n.constructor.name||"Object"==n.constructor.name){return new Function("_this","obj","vn","ixn","fn","for(const i in obj){fn(obj, i, vn, ixn);}")(this,n,this._variableInterableName,this._variableIndexName,this._fn),this._end(),this}const r=new Function("_this","arr","indexBegin","indexEnd","step","vn","ixn","fn","for(var i = indexBegin ; i < indexEnd ; i += step){fn(arr, i, vn, ixn);}");return-1==s&&(s=n.length),r(this,n,e,s,i,this._variableInterableName,this._variableIndexName,this._fn),this._end(),this}end(t){return this._end=t,this}_load(){f.test(this._stmt)?this._loadForeachIndexAndProperties():this._loadForeachProperties()}_loadForeachIndexAndProperties(){this._stmt.replace(f,((t,e,s,i)=>(this._variableInterableName=s,this._objectInterableName=i,this._variableIndexName=e,t)))}_loadForeachProperties(){const t=this._stmt,e=t.trim().split(" ");if(3!=e.length)throw`PiForEachDirective: Statement inválida para laço foreach = ${t}. Padrão esperado: [variável in iterável] ou [(index, variável) in iterável]`;this._variableIndexName=null,this._variableInterableName=e[0],this._objectInterableName=e[2]}}class PiArray{static addMethod(t,e,s){const i=[];null==t[e]?Object.defineProperty(t,e,{enumerable:!1,configurable:!1,writable:!1,value:function(...e){return s.call(t,...e),this}}):i.push(s)}}class PiElement{constructor(t,e={context:{}},s=null){this._element=t,this._attrNames=t.getAttributeNames(),this._destroyed=!1,this._directives=[],this._autoBind=!0,this._element._component=null,this._element._hasComponent=!1,this._element._componentParent=s,this._foreachContext={},this._defaultVariablesNames=[],this._defaultVariablesValues=[],this._scope=e,this._watchs=[],this._children=[],this._events={enter:this._eventEnter},this._orderAttributeNames(),this._loadDirectivesBase(),this._element._pie=!0}addForeachContext(t,e){return this._foreachContext[t]=e,this}setComponent(t){return this._element._hasComponent=!0,this._element._component=t,this}extendForeachContext(t){return PiObject.extend(this._foreachContext,t),this}watch(t,e){return this._addContextWatch(t,e),this}unWatch(t){return this._removeContextWatch(t),this}load(t){return this._loadDefaultVariables(),this._runDirectives(t),this._loadTemplate(),this}_loadDefaultVariables(){let t=Object.keys(this._foreachContext),e=Object.values(this._foreachContext),s=[],i=[];const n=this._element._componentParent;if(null!=n){s=Object.getOwnPropertyNames(n.__proto__);for(let t=0;t<s.length;t++)n[s[t]]instanceof Function&&i.push(n[s[t]].bind(n))}this._defaultVariablesNames=t.concat(s),this._defaultVariablesValues=e.concat(i)}addDirective(t,e){return this._directives[t]=e,this}existDirective(t){return null!=this._directives[t]}get $(){return this._$element?this._$element:this._$element=$(this._element)}on(t,e,...s){return this.listen(t,e,...s)}_eventEnter(t,...e){this._element.addEventListener("keyup",(s=>{13==s.keyCode&&t.apply(this,[s,...e])}))}_eventDefault(t,e,...s){this._element.addEventListener(t,(t=>{e.apply(this,[t,...s])}))}listen(t,e,...s){const i=this._events[t];return i?i.call(this,e,...s):this._eventDefault(t,e,...s),this}off(t,e){return this.unlisten(t,e)}unlisten(t,e){return this._element.removeEventListener(t,e),this}_dispose(){if(!this._destroyed){this._destroyed=!0,this._element.remove();for(let t=0;t<this._children.length;t++)this._children[t].destroy();return this._children=[],this}}destroy(){if(!this._destroyed)return this._dispose(),this._clearContextWatch(),this}insertBefore(t){return this._element.parentNode.insertBefore(t._element,this._element.nextElementSibling),this}insertAfter(t){return this._element.parentNode.insertBefore(t._element,this._element.nextSibling),this}append(t){return this._element.parentNode.append(t._element),this}addEventStatement(t,e,s){const i=new PiExpression(t);return this.listen(s,(function(t){const e=this._getContext(),s=this._getDefaultVariables();s[0].push("$event"),s[1].push(t);const n=i.parse(e,s);return PiStatement.execWithVariables(n,s,e)})),this}setChangeDirective(t){const e=new PiExpression(t);return this.listen("change",(function(t){const s=this._getContext(),i=this._getDefaultVariables();i[0].push("$event"),i[1].push(t);const n=e.parse(s,i);return PiStatement.execWithVariables(n,i,s)})),this}get value(){const t=this._element;return t instanceof HTMLInputElement&&"checkbox"==t.type||t instanceof HTMLInputElement&&"radio"==t.type?t.checked:t.value}set value(t){const e=this._element;return e instanceof HTMLInputElement&&("checkbox"==e.type||"radio"==e.type)?(e.checked=t,this):(e.value=t,this)}addBind(t,e,s){if(null!=t&&0!=t.length)return this._addBindToElementContext(t,s),this}get isDestroyed(){return this._destroyed}setInitDirective(t){const e=new PiExpression(t),s=this._getContext(),i=this._getDefaultVariables(),n=e.parse(s,i);return PiStatement.execWithVariables("this."+n,i,s),this}setModelDirective(t){let e="change";return this._element instanceof HTMLInputElement&&(e="keyup"),this._addBindToElementContext(t,e),this}setValueDirective(t){if(this._destroyed)return this;const e=new PiExpression(t),s=this._getContext();return this.value=e.parse(s,this._getDefaultVariables()),this}setSelectedDirective(t){if(this._destroyed)return this;const e=new PiExpression(t),s=this._getContext(),i=e.parse(s,this._getDefaultVariables());return!0===i||"true"===i?this._element.setAttribute("selected",!0):this._element.removeAttribute("selected"),this}setCheckedDirective(t){if(this._destroyed)return this;const e=new PiExpression(t),s=this._getContext(),i=e.variables;let n=e.parse(s,this._getDefaultVariables());if(this._element.checked="true"==n,i.length>0)for(let t=0;t<i.length;t++){const r=i[t];this._addContextWatch(r,(()=>{n=e.parse(s,this._getDefaultVariables()),this._element.checked="true"==n}))}}setSrcDirective(t){if(this._destroyed)return this;const e=new PiExpression(t),s=this._getContext(),i=e.variables;let n=e.parse(s,this._getDefaultVariables());if(this._element.setAttribute("src",n),i.length>0)for(let t=0;t<i.length;t++){const r=i[t];this._addContextWatch(r,(()=>{n=e.parse(s,this._getDefaultVariables()),this._element.setAttribute("src",n)}))}}setConditionalDirective(t){if(this._destroyed)return this;const e=new PiExpression(t),s=e.variables;if(this._updateConditional(e),s.length>0)for(let t=0;t<s.length;t++){const i=s[t];this._addContextWatch(i,(()=>{this._updateConditional(e)}))}}setDisabledDirective(t){if(this._destroyed)return this;const e=new PiExpression(t);this._updateDisabled(e);for(let t=0;t<e.variables.length;t++){const s=e.variables[t];this._addContextWatch(s,(()=>{this._updateDisabled(e)}))}return this}setStyleDirective(t){if(this._destroyed)return this;this._expressionStyle=new PiExpression(t),this._updateStyle();const e=this._expressionStyle.variables;for(let t=0;t<e.length;t++){const s=e[t];this._addContextWatch(s,(()=>{this._updateStyle()}))}return this}setClassDirective(t){if(this._destroyed)return this;this._expressionClass=new PiExpression(t),this._updateClass();const e=this._expressionClass.variables;for(let t=0;t<e.length;t++){const s=e[t];this._addContextWatch(s,(()=>{this._updateClass()}))}return this}setForDirective(t){const e=new PiExpression(t),s=this._getContext(),i=this._getDefaultVariables(),n=e.parse(s,i),r=new PiForDirective(n),l=this._getPiAttributeNodes([":for"]);let a=[],o=document.createTextNode("");if(this._element.parentNode.insertBefore(o,this._element.nextSibling),r.loop(((t,e)=>{const s=this._element.componentParent;this._setAttributeNodes(l);const i=this._element.cloneNode(!0),n=new PiElement(i,this._scope,s);n.extendForeachContext(this._foreachContext),n._autoBind=!1,n.addForeachContext(t,e),n.load(s);const r=new PiVirtualTree(i.children,this._scope,s);r.hook("did:create:velement",(t=>{n._children.push(t),t.extendForeachContext(n._foreachContext)})),r.load(),a.push(n)})).end((()=>{for(let t=a.length-1;t>=0;t--){const e=a[t]._element;o.parentNode.insertBefore(e,o.nextSibling)}})).run(),e.variables.length>0)for(let t=0;t<e.variables.length;t++){const s=e.variables[t];this._addContextWatch(s,(t=>{for(let t=0;t<a.length;t++)a[t].destroy();a=[],r.run(t)}))}return this._element.parentElement.dispatchEvent(new CustomEvent("fordone",{bubbles:!0,cancelable:!0,composed:!1})),this._dispose(),this}setForEachDirective(t){const e=new PiExpression(t),s=this._getContext(),n=this._getDefaultVariables(),r=e.parse(s,n),l=new PiForEachDirective(r),a=l.objectInterableName,o=this._getPiAttributeNodes([":foreach"]);let h=PiObject.extractValue(this._scope,"context."+a);if(null==h&&(h=i(a)),null==h&&(h=PiObject.extractValue(this._foreachContext,a)),null==h)throw`ForEach: propriedade não encontrada '${a}'`;let c=[],u=[];var d=document.createTextNode("");this._element.parentNode.insertBefore(d,this._element.nextSibling),l.loop(((t,e,s,i)=>{const n=this._element._componentParent,r=s,l=h[e],a=i;this._setAttributeNodes(o);const d=this._element.cloneNode(!0),p=new PiElement(d,this._scope,n);p.extendForeachContext(this._foreachContext),p._autoBind=!1,p.addForeachContext(r,l),a&&p.addForeachContext(a,e),p.load(n);const _=new PiVirtualTree(d.children,this._scope,n);_.hook("did:create:velement",(t=>{p._children.push(t),t.extendForeachContext(p._foreachContext)})),_.load(),c.push(d),u.push(p)})).end((()=>{for(let t=0;t<c.length;t++){const e=c[t];d.parentNode.insertBefore(e,d)}c=[]})).run(h);const p=function(t,e,s,...i){if(s>0){const i=e+s>u.length?u.length:e+s;for(let t=e;t<i;t++)u[t].destroy();Array.prototype.splice.call(t,e,s),u.splice(e,s)}return i.length>0&&(Array.prototype.splice.call(t,e,0,...i),l.run(t,e)),t};return type_PiType.isArray(h)&&(PiArray.addMethod(h,"load",(function(t,e=0){return p(this,e,0,...t),this})),PiArray.addMethod(h,"add",(function(t){return p(this,this.length,0,t),this})),PiArray.addMethod(h,"clear",(function(){return p(this,0,this.length),this})),PiArray.addMethod(h,"remove",(function(t){return p(this,t,1),this})),PiArray.addMethod(h,"reload",(function(){for(let t=0;t<this.length;t++)u[t].destroy();u=[],l.run(this,0)}))),this._element.parentElement.dispatchEvent(new CustomEvent("fordone",{bubbles:!0,cancelable:!0,composed:!1})),this.destroy(),this}setRenderDirective(t,e,s,i){const n=this._getContext(),r=this._getDefaultVariables(),l=PiStatement.execWithVariables(t,r,n);let a;a=l.name==t?new l:l.call?l.call(i):l,this._loadLoader(),a instanceof Promise?a.then((t=>{this.setComponent(t),t.render(this._element)})):a instanceof PiPromise?a.ok((t=>{this.setComponent(t),t.render(this._element)})):(this.setComponent(a),a.render(this._element))}_getValueFromDefaultVariables(t){const{defaultNames:e,defaultValues:s}=this._getDefaultVariables();for(let i=0;i<e.length;i++){if(e[i]==t)return s[i]}return null}_getDefaultVariables(){const t=this._element._component||this._element._componentParent,s=this._element.get?this._element.get():"",i=["$this","$element","$value"],n=[t,this._element,s];return this._loadDefaultVariables(),e.forEach((t=>{i.push(t.name),n.push(t)})),[this._defaultVariablesNames.concat(i),this._defaultVariablesValues.concat(n)]}_addBindToElementContext(t,e){let s=!1;const i=PiObject.extractValue(this._scope,"context."+t);return this._element.set(i),this._addContextWatch(t,(()=>{if(s)return;const e=PiObject.extractValue(this._scope,"context."+t);this._element.set(e),this._updateView()})),!1!==e?this.listen(e,(function(){s=!0,PiObject.setProperty(this._scope.context,t,this.value),s=!1})):this.listen("change",(function(e){s=!0,PiObject.setProperty(this._scope.context,t,e.detail),s=!1})),this}_getPiAttributeNodes(t=[]){const e=[];for(let s=0;s<this._attrNames.length;s++){const i=this._attrNames[s],n=i[0];-1!=t.indexOf(i)||":"!=n&&"#"!=n&&"@"!=n||e.push(this._element.getAttributeNode(i))}return e}_setAttributeNodes(t=[]){for(let e=0;e<t.length;e++){const s=t[e];null!=s&&this._element.setAttributeNode(s)}return this}setMountDirective(t){return this._element.mount=e=>{const s=new PiExpression(t),i=this._getContext(),n=this._getDefaultVariables(),r=s.parse(i,n);n.$this=e,PiStatement.execWithVariables("this."+r,n,i)},this}setDidMountDirective(){}setWillMountDirective(){}setForEndValueDirective(t,e,s,i){"value"!=s&&"setValue"!=s||this.listen(e,(function(e){const s=new PiExpression(t),i=this._getContext(),n=this._getDefaultVariables();this.value=s.parse(i,n)}))}_loadDirectivesBase(){this.addDirective("for",this.setForDirective),this.addDirective("foreach",this.setForEachDirective),this.addDirective("loader",this.setLoaderDirective),this.addDirective("class",this.setClassDirective),this.addDirective("style",this.setStyleDirective),this.addDirective("init",this.setInitDirective),this.addDirective("bind",this.addBind),this.addDirective("on",this.addEventStatement),this.addDirective("value",this.setValueDirective),this.addDirective("selected",this.setSelectedDirective),this.addDirective("disabled",this.setDisabledDirective),this.addDirective("if",this.setConditionalDirective),this.addDirective("model",this.setModelDirective),this.addDirective("change",this.setChangeDirective),this.addDirective("src",this.setSrcDirective),this.addDirective("checked",this.setCheckedDirective),this.addDirective("mount",this.setMountDirective),this.addDirective("render",this.setRenderDirective),this.addDirective("forend",this.setForEndValueDirective),this.addDirective("fordone",this.setForEndValueDirective)}setLoaderDirective(t,e,s,i){const n=this._getContext(),r=this._getDefaultVariables(),l=PiStatement.execWithVariables(t,r,n);if(l.name==t){(new l).render(this._element)}else if(l.call){l.call(i).render(this._element)}else l.render(this._element);this._hasLoader=!0}_loadLoader(){if(null==this._hasLoader){const t=l.get("html.loader");let e=t;"Function"==t.constructor.name&&(e=t()),this._element.innerHTML=e}}_(t){Object.keys(t);const e=Object.values(t);for(let s=0;s<e.length;s++){const i=e[s];i instanceof Function&&(e[s]=i.bind(t))}}_createExpression(t,e){const s=new PiExpression(t);if(e._piex=s,this._autoBind)for(let t=0;t<s.variables.length;t++){const e=s.variables[t];this._addContextWatch(e,(()=>{this._updateView()}))}}_loadTemplate(){if(this._destroyed)return;const t=this._element.childNodes,e=l.get("expression.xhtml");for(let s=0;s<t.length;s++){let i=t[s],n=i.nodeValue;if(n&&e.test(n)){const t=document.createElement("span");t.innerHTML=n,i.parentNode.insertBefore(t,i.nextSibling),this._element.removeChild(i),this._createExpression(n,t),s--}else n&&n.indexOf("{")>-1&&i instanceof Text&&this._createExpression(n,i)}this._updateView()}_updateConditional(t){const e=this._getContext(),s=this._getDefaultVariables(),i=PiStatement.execWithVariables(t.parse(e,s),s,e),n=this._element.nextElementSibling;n&&n.hasAttribute(":else")&&(n.__pielse=!0,n.removeAttribute(":else"));const r=n&&n.__pielse;i?(this.$.show(),r&&$(n).hide()):(this.$.hide(),r&&$(n).show())}_updateDisabled(t){const e=this._getContext(),s=t.parse(e,this._getDefaultVariables());"true"==s||!0===s?this._element.setAttribute("disabled",!0):this._element.removeAttribute("disabled")}_updateView(){if(this._destroyed)return;const t=this._element.childNodes;for(let e=0;e<t.length;e++){const s=t[e];if(s._piex){const t=s._piex.parse(this._getContext(),this._getDefaultVariables());s instanceof Text?s.nodeValue=t:s.innerHTML=t}}}_updateStyle(){if(!this._destroyed&&this._expressionStyle){const t=this._expressionStyle.parse(this._getContext(),this._getDefaultVariables()).split(";");for(let e=0;e<t.length;e++){const s=t[e].split(":");if(2!=s.length)continue;const i=s[0].trim(),n=s[1].trim();this.$.css(i,n)}}}_updateClass(){if(!this._destroyed&&this._expressionClass){const t=this._expressionClass.parse(this._getContext(),this._getDefaultVariables()).trim();if(t==this._element.className)return;this._element.className="",t.length>0&&this._element.classList.add(...t.split(" ").filter((t=>""!==t)))}}_orderAttributeNames(){let t=this._attrNames.indexOf("foreach");t>-1&&(this._attrNames.splice(t,1),this._attrNames.unshift("foreach")),t=this._attrNames.indexOf("for"),t>-1&&(this._attrNames.splice(t,1),this._attrNames.unshift("for"))}_runDirectives(t){if(!this._destroyed)for(let e=0;e<this._attrNames.length;e++){const s=this._attrNames[e],i=this._element.getAttribute(s),{propName:n,eventName:r}=this._extractPiAttributeNameAndProperty(s);if(this.existDirective(n))this._element.removeAttribute(s),this._directives[n].call(this,i,n,r,t);else{if("foreach"==n)return;if("for"==n)return;if(0!=s.indexOf("#"))if(0!=s.indexOf(":"));else{const t=new PiExpression(i),e=this._getContext(),n=t.variables;let r=t.parse(e,this._getDefaultVariables());if(r&&this._element.setAttribute(s.substr(1),r),this._element.removeAttribute(s),n.length>0)for(let i=0;i<n.length;i++){const l=n[i];this._addContextWatch(l,(()=>{r=t.parse(e,this._getDefaultVariables()),this._element.setAttribute(s.substr(1),r)}))}}else{const t=new PiExpression(i).parse(this._getContext(),this._getDefaultVariables());t&&this._element.setAttribute(s.substr(1),t),this._element.removeAttribute(s)}}}}_extractPiAttributeNameAndProperty(t){let e="",s=!1;if(t.indexOf("@")>-1){e="on",s=t.replace("@","");const i=s.split(":");i.length>1&&(e=i[0],s=i[1])}else if(t.indexOf(":")>-1){e=t.replace(":","");const i=e.split(".");i.length>1&&(e=i[0],s=i[1])}return{propName:e,eventName:s}}_getContext(){return this._scope.context}_clearContextWatch(){let t=[];for(let e=0;e<this._watchs.length;e++)t=t.concat(this._watchs[e].ids);PiObject.off(this._scope,t),this._watchs=[]}_addContextWatch(t,e){const s=PiObject.on(this._scope,"context."+t,e);return this._watchs=this._watchs.concat({property:t,ids:s}),this}_removeContextWatch(t){const e=this._watchs;for(let s=0;s<e.length;s++)if(e[s].property==t){PiObject.off(this._scope,e[s].ids);break}return this}}class PiVirtualTree{#D=null;#w=[];#E=[];#O=[];#S=null;#N=[];#U={context:{}};constructor(t,e={context:{}},s=null){t instanceof Array||t instanceof HTMLCollection?this.#D=t:this.#D=[t],this.#S=s,this.#U=e}hook(t,e){return this.#N[t]=e,this}load(){return this._createVirtualElements(this.#D),this._createComponents(),this}destroy(){for(let t=0;t<this.#w.length;t++){this.#w[t].destroy()}for(let t=0;t<this.#E.length;t++)this.#E[t].destroy();return this.#w=[],this.#E=[],this.#O=[],this}_createComponent(t){const e=i(t);if(null==e)throw`Component não localizado: ${t}`;return new e}_createComponents(){for(let e=0;e<this.#O.length;e++){const s=this.#O[e],i=s.componentName,n=s.velement,r=n._element,l=r.getAttribute("name");var t=null;this.#S&&l?null==(t=this.#S[l])&&(t=this._createComponent(i),this.#S[l]=t):t=this._createComponent(i),n.setComponent(t),t.render(r),this.#E.push(t)}}_createVirtualElements(t){if(null!=t)if(1==t.length&&t[0]instanceof DocumentFragment)this._createVirtualElements(t[0].children);else for(let e=0;e<t.length;e++){const s=t[e];if(!(s instanceof Text)&&!(s instanceof HTMLScriptElement||s instanceof HTMLStyleElement)){if(null==s._pie){this._invokeHook("will:create:velement");const t=new PiElement(s,this.#U,this.#S);if(this._invokeHook("did:create:velement",t),this._invokeHook("will:load:velement",t),t.load(this.#S),this._invokeHook("did:load:velement",t),t.isDestroyed){e--;continue}const i=s.getAttribute("component");null!=i&&this.#O.push({velement:t,componentName:i}),this.#w.push(t)}this._createVirtualElements(s.children)}}}_invokeHook(t,...e){return this.#N[t]&&this.#N[t](...e),this}}const g=t.$;class PiComponent extends PiClass{event=new PiEvent;#V=[];#T=[];#U=null;#A=null;#j=!1;#k="";constructor(...t){super(...t),this.#U={context:this},this.#k=PiRandom.uuid("xx-xx")}init(...t){super.init(...t),this._loadPromise=new PiPromise,this.willLoad(this._loadPromise)}inject(t){if(t instanceof PiModel){const e=PiString.clips(this.view,'data-model="','"');for(let s=0;s<e.length;s++){const i=e[s],n=this.element.querySelector('[data-model="'+i+'"]'),r=PiObject.extractValue(t,i);n._hasComponent?n._component.set(r):n.firstChild&&n.firstChild._hasComponent?n.firstChild._component.set(r):n.set(r)}}else super.inject(t);return this}get(){return""}set(t){return null==this.element||this.dispatchEvent("change",t),this}dispatchEvent(t,e,s=!0){if(null==this.element)return this;var i=e;return s&&(i=new CustomEvent(t,{bubbles:!0,cancelable:!0,composed:!1,detail:e})),this.#j?this.element.dispatchEvent(i):this.element.parentElement.dispatchEvent(i),this}get $element(){return this.#A?this.#A:this.#A=g(this.element)}render(t,e=!1){return t instanceof g&&(t=t.get(0)),this._loadPromise.once((()=>{this.#F(t),t.mount&&t.mount(this),this.viewWillLoad(),this.viewWillRender(),this.viewRender(t,e),this.viewDidRender(),this.#L(),this.viewDidLoad(),t.didMount&&t.didMount(this),this.element.setAttribute("data-id",this.#k)})),this}get isRendered(){const t=document.querySelector(`[data-id="${this.#k}"]`);return document.contains(t)}willLoad(t){t.resolve()}didLoad(){}viewWillLoad(){}viewWillRender(){}viewDidRender(){}viewRender(t,e=!1){if(e||(t.innerHTML=""),this.view){const e=this.loadView(this.view,t);1==e.length?(this.element=e[0],this.#j=!1):(this.element=t,this.#j=!0)}else this.element=t}viewDidLoad(){}watch(t,e){const s=PiObject.on(this.#U,"context."+t,e);return this.#T=this.#T.concat({property:t,ids:s}),this}unWatch(t){const e=this.#T;for(let s=0;s<e.length;s++)if(e[s].property==t){PiObject.off(this.#U,e[s].ids);break}return this}destroy(){for(let t=0;t<this.#V.length;t++){this.#V[t].destroy()}this.#V=[],this.#W()}loadView(t,e){const s=PiTree.parse(t),i=[];for(;s.childElementCount;){const t=s.children[0];e.append(t),i.push(t)}return this.#q(i),i}#q(t){const e=new PiVirtualTree(t,this.#U,this);e.load(),this.#V.push(e)}#L(){if(null==this.element)return this;const t=this;new MutationObserver((function(e){e.forEach((function(e){if("childList"==e.type)for(var s=0;s<e.addedNodes.length;s++){const i=e.addedNodes[s];t.#q(i)}}))})).observe(this.element,{childList:!0,attributes:!1,characterData:!1,subtree:!1,attributeOldValue:!1,characterDataOldValue:!1})}#W(){let t=[];for(let e=0;e<this.#T.length;e++)t=t.concat(this.#T[e].ids);PiObject.off(this.#U,t),this.#T=[]}#F(t){if(null==t.getAttributeNames)return;const e=t.getAttributeNames();for(let s=0;s<e.length;s++){const i=e[s];let n=t.getAttribute(i);if(-1==i.indexOf("prop-"))continue;type_PiType.isString(n)&&(type_PiType.isObject(n)||type_PiType.isArray(n))&&(n=JSON.parse(n));this[i.replace("prop-","")]=n}}static register(t){s(t)}}window.bird.init("TestBird",class TestBird extends PiComponent{view='<div> Bird Test <button @click="clickme()">ClickMe</button></div>';clickme(){console.log("Funcionalidade não implementada aina"),alert("Funcionalidade não implementada aina")}})})();